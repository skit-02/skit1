<!DOCTYPE html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>wordtest_target1900</title>
    <link rel="stylesheet" href="https://pyscript.net/alpha/pyscript.css" />
    <script defer src="https://pyscript.net/alpha/pyscript.js"></script>
    <link rel="stylesheet" href="stylesheet_1900.css">
</head>

<body>
    <h1>単語の範囲を入力してください</h1>
    <form id="rangeForm"><!--formタグはサーバーに送信するのに必要-->
        <label for="start">最初の値:</label>
        <input type="number" id="start" required>
        <br>
        <label for="end">最後の値:</label>
        <input type="number" id="end" required>
        <br>
        <button type="button" onclick="generateRandomNumbers()">OK</button>
    </form>

    <input type="file" id="fileInput" accept=".txt">
    <br>
    <button onclick="readFile()">ファイルを読み込む</button>
    <pre id="output"></pre>

    <form>
        <button onclick="downloadFile()">テストをダウンロードする</button>
    </form>

    <script>
        var resultArray;
        var uniqueRandomNumbers;

        function generateRandomNumbers() {
            // 入力値の取得(documentはhtmlの操作に使う接頭辞みたいなやつ)
            var startValue = parseInt(document.getElementById('start').value); //parseIntで数字に変換
            var endValue = parseInt(document.getElementById('end').value);

            // 入力が有効であるか確認
            if (isNaN(startValue) || isNaN(endValue)) {
                alert('有効な数値を入力してください。'); // alertはポップアップ表示めっちゃいい
                return;
            }

            // ランダムな数列の生成(varが配列)
            uniqueRandomNumbers = getUniqueRandomNumbers(startValue, endValue, 20);
            // 数列をソート
            uniqueRandomNumbers.sort(function (a, b) {
                return a - b;
            });
        }

        function getUniqueRandomNumbers(min, max, count) {
            var numbers = [];

            // 利用可能なすべての数値を含む配列を作成
            for (var i = min; i <= max; i++) {
                numbers.push(i);
            }

            // 配列からランダムに数を選んで取り除く
            var result = [];
            for (var j = 0; j < count; j++) {
                var randomIndex = Math.floor(Math.random() * numbers.length);
                var selectedNumber = numbers.splice(randomIndex, 1)[0];
                result.push(selectedNumber);
            }

            return result;
        }
        function readFile() {
            var fileInput = document.getElementById('fileInput');
            var outputElement = document.getElementById('output');

            var file = fileInput.files[0];
            if (file) {
                var reader = new FileReader();

                reader.onload = function (e) {
                    var content = e.target.result;

                    // 各行ごとに分割
                    var lines = content.split('\n');

                    // 各行を処理({}は辞書みたいな感じ)
                    resultArray = lines.map(function (line) {
                        var [num, eng, jap, info] = line.split('\t');
                        return [num, eng, jap, info];
                    });

                    // 結果を表示
                    outputElement.textContent = 'ファイルの読み込みが完了しました';
                };

                reader.readAsText(file);
            } else {
                outputElement.textContent = "ファイルが選択されていません。";
            }
        }
        function downloadFile() {
            // 対応する英単語を抽出
            var selectedWords = uniqueRandomNumbers.map(function (sequenceNumber) {
                var foundObject = resultArray.find(item => item[0] == sequenceNumber.toString());
                return foundObject ? parseInt(foundObject[0]) + ' ' + ',' + foundObject[1] + ',' + ': _ _ _ _ _ _' : '';
            });

            // 文字数ごとに改行を挿入
            var csvContent = "";
            for (var i = 0; i < 20; i += 2) {
                csvContent += selectedWords[i];
                csvContent += ',';
                csvContent += selectedWords[i + 1];
                csvContent += '\n';
            }

            // Blobオブジェクトを生成
            var blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8' });

            // ダウンロード用のリンクを作成
            var downloadLink = document.createElement('a');
            downloadLink.href = URL.createObjectURL(blob);
            downloadLink.download = 'output.csv';

            // リンクをクリックしてダウンロードを開始
            downloadLink.click();
        }
    </script>
</body>

</html>

<!--選択画面をなくしてファイルの選択から単語帳の選択をするのどっちがいいか，
    あと作成日とかいる？
それとサイズの調整-->
